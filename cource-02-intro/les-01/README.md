
# Проектирование базы данных, нормальные формы

Возьмем для примера обычный интернет-магазин, в котором продается  электроника. Каждый раз когда пользователь делает заказ, в базу данных  заносится запись об этом (в таблицу *order_items*). В нее входит  вся необходимая информация: какой товар купил пользователь, сколько он  стоил, адрес доставки и другое. Затем эти данные используются всеми  подразделениями интернет-магазина, начиная от бухгалтеров, заканчивая  службой доставки.

| first_name | last_name | address                  | item            | price            |
| ---------- | --------- | ------------------------ | --------------- | ---------------- |
| Сергей     | Иванов    | Москва, ул. Промышленная | утюг            | 15.00            |
| Иван       | Петров    | Самара, ул. Энгельса     | кофеварка       | 5000.00          |
| Виктор     | Сидоров   | Омск, ул. Дворцовая      | утюг, телевизор | 1000.00, 6500.00 |
| Сергей     | Иванов    | Москва, ул. Матросова    | ноутбук         | 20000.00         |
| Сергей     | Иванов    | Москва, ул. Матросова    | ноутбук         | 20000.00         |

## Первая нормальная форма (1NF) 

### Основные критерии:

- Все строки должны быть различными.
- Все элементы внутри ячеек должны быть атомарными (не списками). 

> Другими словами, элемент является атомарным, если его нельзя разделить на части, которые могут использовать в таблице независимо друг от друга.

### Методы приведения к 1NF:

- Устраните повторяющиеся группы в отдельных таблицах (одинаковые строки). 
- Создайте отдельную таблицу для каждого набора связанных данных. 
- Идентифицируйте каждый набор связанных данных с помощью первичного ключа (добавить уникальный id для каждой строки)


| id  | first_name | last_name | address                  | item      | price    |
| --- | ---------- | --------- | ------------------------ | --------- | -------- |
| 8   | Сергей     | Иванов    | Москва, ул. Промышленная | утюг      | 1000.00  |
| 2   | Иван       | Петров    | Самара, ул. Энгельса     | кофеварка | 5000.00  |
| 7   | Виктор     | Сидоров   | Омск, ул. Дворцовая      | утюг      | 1000.00  |
| 4   | Виктор     | Сидоров   | Омск, ул. Дворцовая      | телевизор | 6500.00  |
| 9   | Сергей     | Иванов    | Москва, ул. Матросова    | ноутбук   | 20000.00 |
| 6   | Сергей     | Иванов    | Москва, ул. Матросова    | ноутбук   | 20000.00 |


## Вторая нормальная форма (2NF)

### Основные критерии:

- Таблица должна находиться в первой нормальной форме. 
- Любое её поле, не входящее в состав первичного ключа, функционально полно зависит от первичного ключа. 

> Ваша таблица приведена к первой нормальной форме и у нее установлен уникальный id для каждой строки, то она находится и во второй нормальной форме.

### Методы приведения к 2NF:

- Создайте отдельные таблицы для наборов значений, относящихся к нескольким записям 
- Свяжите эти таблицы с помощью внешнего ключа

| id   | first_name | last_name |
| ---- | ---------- | --------- |
| 2    | Сергей     | Иванов    |
| 3    | Иван       | Петров    |
| 5    | Виктор     | Сидоров   |

***

| id   | user_id | address                  | good_id | price    |
| ---- | ------- | ------------------------ | ------- | -------- |
| 8    | 2       | Москва, ул. Промышленная | 50      | 1000.00  |
| 2    | 3       | Самара, ул. Энгельса     | 30      | 5000.00  |
| 7    | 5       | Омск, ул. Дворцовая      | 50      | 1000.00  |
| 4    | 5       | Омск, ул. Дворцовая      | 20      | 6500.00  |
| 9    | 2       | Москва, ул. Матросова    | 33      | 20000.00 |
| 6    | 2       | Москва, ул. Матросова    | 33      | 20000.00 |

***

| id   | name      |
| ---- | --------- |
| 50   | утюг      |
| 30   | кофеварка |
| 20   | телевизор |
| 33   | ноутбук   |


## Третья нормальная форма (3NF)

### Основные критерии:

- Таблица находится во второй нормальной форме. 
- Любой её не ключевой атрибут функционально зависит только от первичного ключа.

> Проще говоря, второе правило требует выносить все не ключевые поля, содержимое которых может относиться к нескольким записям таблицы в отдельные таблицы.

### Методы приведения к 3NF:

- Удаление полей не зависящих от ключа

> Стоимость заказа зависит от цены товара, но в то же время, цена  товара, как это ни странно, зависит от самого товара, т.е. от *good_id*. Для приведения таблицы к третьей форме, нам нужно вынести цену в товар:

| id   | first_name | last_name |
| ---- | ---------- | --------- |
| 2    | Сергей     | Иванов    |
| 3    | Иван       | Петров    |
| 5    | Виктор     | Сидоров   |

***

| id   | user_id | address                  | good_id |
| ---- | ------- | ------------------------ | ------- |
| 8    | 2       | Москва, ул. Промышленная | 50      |
| 2    | 3       | Самара, ул. Энгельса     | 30      |
| 7    | 5       | Омск, ул. Дворцовая      | 50      |
| 4    | 5       | Омск, ул. Дворцовая      | 20      |
| 9    | 2       | Москва, ул. Матросова    | 33      |
| 6    | 2       | Москва, ул. Матросова    | 33      |

***

| id   | name      | price    |
| ---- | --------- | -------- |
| 50   | утюг      | 1000.00  |
| 30   | кофеварка | 5000.00  |
| 20   | телевизор | 6500.00  |
| 33   | ноутбук   | 20000.00 |

